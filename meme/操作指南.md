# SHIB风格Meme代币操作指南

## 一、合约概述

本指南详细说明如何部署和使用SHIB风格的Meme代币合约。该合约基于ERC20标准，集成了代币税机制、流动性池集成和交易限制功能。

### 主要特性
- **代币税机制**：每笔交易征收可配置比例的税费
- **流动性池集成**：自动将部分税收注入流动性池
- **交易限制**：防止市场操纵和保护投资者
- **安全防护**：多重安全机制确保合约安全

## 二、环境准备

### 2.1 开发环境要求

**必要工具**：
- Node.js (版本 16.0 或更高)
- npm 或 yarn 包管理器
- Hardhat 或 Truffle 开发框架
- MetaMask 钱包

**依赖安装**：
```bash
# 使用 npm
npm install @openzeppelin/contracts
npm install --save-dev hardhat @nomiclabs/hardhat-ethers ethers

# 或使用 yarn
yarn add @openzeppelin/contracts
yarn add --dev hardhat @nomiclabs/hardhat-ethers ethers
```

### 2.2 网络配置

**测试网络配置**：
```javascript
// hardhat.config.js
module.exports = {
  networks: {
    goerli: {
      url: "https://goerli.infura.io/v3/YOUR-PROJECT-ID",
      accounts: [process.env.PRIVATE_KEY]
    },
    sepolia: {
      url: "https://sepolia.infura.io/v3/YOUR-PROJECT-ID", 
      accounts: [process.env.PRIVATE_KEY]
    }
  }
};
```

## 三、合约部署

### 3.1 部署脚本

创建部署脚本 `deploy.js`：

```javascript
// scripts/deploy.js
const { ethers } = require("hardhat");

async function main() {
  // 获取部署者账户
  const [deployer] = await ethers.getSigners();
  
  console.log("使用账户部署合约:", deployer.address);
  console.log("账户余额:", (await deployer.getBalance()).toString());

  // 部署参数
  const tokenName = "SHIB Style Meme Token";
  const tokenSymbol = "SSMT"; 
  const initialSupply = ethers.utils.parseEther("1000000000"); // 10亿代币
  const treasuryWallet = "0x..."; // 替换为实际国库地址

  // 部署合约
  const SHIBToken = await ethers.getContractFactory("SHIBToken");
  const token = await SHIBToken.deploy(
    tokenName,
    tokenSymbol, 
    initialSupply,
    treasuryWallet
  );

  await token.deployed();
  
  console.log("SHIBToken 部署地址:", token.address);
  console.log("交易哈希:", token.deployTransaction.hash);
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
```

### 3.2 执行部署

```bash
# 部署到本地网络
npx hardhat run scripts/deploy.js

# 部署到Goerli测试网
npx hardhat run scripts/deploy.js --network goerli

# 部署到Sepolia测试网  
npx hardhat run scripts/deploy.js --network sepolia
```

### 3.3 部署后配置

部署完成后，需要配置合约参数：

```javascript
// 配置脚本
async function configureContract() {
  const token = await ethers.getContractAt("SHIBToken", "0x...合约地址");
  
  // 设置流动性池地址
  await token.setLiquidityPool("0x...流动性池地址");
  
  // 设置税收分配比例
  await token.setTaxDistribution(40, 30, 30); // 流动性40%，销毁30%，国库30%
  
  // 设置交易限制
  await token.updateTradingRestrictions(
    ethers.utils.parseEther("1000000"), // 最大交易量 100万代币
    ethers.utils.parseEther("5000000"), // 最大钱包余额 500万代币  
    300 // 冷却时间 300秒
  );
}
```

## 四、合约功能使用

### 4.1 基本代币操作

**转账操作**：
```javascript
// 普通转账（会征收代币税）
const tx = await token.transfer(recipient, amount);
await tx.wait();

// 查看余额
const balance = await token.balanceOf(account);

// 查看总供应量
const totalSupply = await token.totalSupply();
```

**授权操作**：
```javascript
// 授权其他地址使用代币
await token.approve(spender, amount);

// 从授权地址转账
await token.transferFrom(from, to, amount);
```

### 4.2 代币税功能

**查看税率设置**：
```javascript
const taxRate = await token.taxRate(); // 返回百分比值
const maxTaxRate = await token.MAX_TAX_RATE();
```

**调整税率（仅管理员）**：
```javascript
// 设置新税率（最大10%）
await token.setTaxRate(3); // 设置为3%
```

**查看税收分配**：
```javascript
const liquidityShare = await token.liquidityPoolShare();
const burnShare = await token.burnShare(); 
const treasuryShare = await token.treasuryShare();
```

### 4.3 交易限制管理

**查看限制参数**：
```javascript
const maxTx = await token.maxTransactionAmount();
const maxWallet = await token.maxWalletBalance(); 
const cooldown = await token.cooldownPeriod();
```

**调整限制参数（仅管理员）**：
```javascript
await token.updateTradingRestrictions(
  ethers.utils.parseEther("2000000"), // 新最大交易量
  ethers.utils.parseEther("8000000"), // 新最大钱包余额
  600 // 新冷却时间
);
```

**排除地址（仅管理员）**：
```javascript
// 将地址排除在税收和限制之外
await token.excludeFromTaxAndLimit(account, true);

// 检查地址是否被排除
const isExcluded = await token.isExcludedFromTax(account);
```

### 4.4 流动性池集成

**设置流动性池**：
```javascript
await token.setLiquidityPool(liquidityPoolAddress);
```

**手动添加流动性**：
```javascript
// 需要先授权代币给合约
await token.approve(token.address, tokenAmount);

// 添加流动性（需要发送ETH）
await token.manualAddLiquidity(tokenAmount, ethAmount, {
  value: ethAmount
});
```

## 五、管理员功能

### 5.1 紧急操作

**暂停交易**：
```javascript
// 紧急情况下暂停所有交易
await token.emergencyPause();
```

**恢复交易**：
```javascript
// 恢复正常交易
await token.resumeTrading(
  ethers.utils.parseEther("1000000"),
  300
);
```

### 5.2 权限管理

**所有权转移**：
```javascript
// 转移合约所有权
await token.transferOwnership(newOwner);
```

**放弃所有权**：
```javascript
// 放弃合约所有权（不可逆）
await token.renounceOwnership();
```

## 六、前端集成示例

### 6.1 Web3集成

```javascript
import { ethers } from 'ethers';
import SHIBTokenABI from './abis/SHIBToken.json';

class SHIBTokenService {
  constructor(contractAddress, provider) {
    this.contract = new ethers.Contract(
      contractAddress, 
      SHIBTokenABI, 
      provider
    );
  }

  // 获取代币信息
  async getTokenInfo() {
    const [name, symbol, totalSupply] = await Promise.all([
      this.contract.name(),
      this.contract.symbol(), 
      this.contract.totalSupply()
    ]);
    
    return { name, symbol, totalSupply };
  }

  // 执行转账
  async transfer(recipient, amount, signer) {
    const contractWithSigner = this.contract.connect(signer);
    const tx = await contractWithSigner.transfer(recipient, amount);
    return await tx.wait();
  }

  // 获取税收信息
  async getTaxInfo() {
    const [taxRate, liquidityShare, burnShare, treasuryShare] = await Promise.all([
      this.contract.taxRate(),
      this.contract.liquidityPoolShare(),
      this.contract.burnShare(),
      this.contract.treasuryShare()
    ]);
    
    return { taxRate, liquidityShare, burnShare, treasuryShare };
  }
}
```

### 6.2 React组件示例

```jsx
import React, { useState, useEffect } from 'react';
import { useWeb3React } from '@web3-react/core';
import { SHIBTokenService } from '../services/shibTokenService';

function TokenTransfer() {
  const { account, library } = useWeb3React();
  const [tokenService, setTokenService] = useState(null);
  const [recipient, setRecipient] = useState('');
  const [amount, setAmount] = useState('');
  const [taxInfo, setTaxInfo] = useState(null);

  useEffect(() => {
    if (library && account) {
      const service = new SHIBTokenService(
        '0x...合约地址', 
        library
      );
      setTokenService(service);
      
      // 获取税收信息
      service.getTaxInfo().then(setTaxInfo);
    }
  }, [library, account]);

  const handleTransfer = async () => {
    if (!tokenService) return;
    
    try {
      const signer = library.getSigner();
      const result = await tokenService.transfer(recipient, amount, signer);
      console.log('转账成功:', result);
    } catch (error) {
      console.error('转账失败:', error);
    }
  };

  return (
    <div>
      <h3>SHIB代币转账</h3>
      <input 
        type="text" 
        placeholder="接收地址"
        value={recipient}
        onChange={(e) => setRecipient(e.target.value)}
      />
      <input 
        type="number" 
        placeholder="转账金额"
        value={amount}
        onChange={(e) => setAmount(e.target.value)}
      />
      {taxInfo && (
        <p>税率: {taxInfo.taxRate}% (流动性: {taxInfo.liquidityShare}%, 销毁: {taxInfo.burnShare}%, 国库: {taxInfo.treasuryShare}%)</p>
      )}
      <button onClick={handleTransfer}>转账</button>
    </div>
  );
}
```

## 七、安全注意事项

### 7.1 私钥安全
- 永远不要将私钥硬编码在代码中
- 使用环境变量或安全的密钥管理系统
- 测试网私钥也要妥善保管

### 7.2 合约安全
- 部署前充分测试所有功能
- 设置合理的交易限制参数
- 定期审查合约权限设置

### 7.3 用户安全
- 向用户清晰说明代币税机制
- 提供交易限制的透明信息
- 建立完善的用户支持系统

## 八、故障排除

### 8.1 常见错误

**Gas不足错误**：
- 增加Gas限制
- 检查Gas价格设置

**交易限制错误**：
- 检查交易金额是否超过限制
- 确认冷却时间是否已过
- 验证钱包余额限制

**权限错误**：
- 确认操作者具有相应权限
- 检查合约所有权设置

### 8.2 调试技巧

```javascript
// 启用详细日志
const token = await ethers.getContractAt("SHIBToken", contractAddress);
const tx = await token.transfer(recipient, amount);

// 等待交易确认并获取详细信息
const receipt = await tx.wait();
console.log('交易详情:', receipt);

// 检查事件日志
const events = receipt.events.filter(x => x.event === 'TaxApplied');
if (events.length > 0) {
  console.log('税收事件:', events[0].args);
}
```

## 九、最佳实践

### 9.1 部署最佳实践
- 先在测试网充分测试
- 逐步增加交易限制严格度
- 设置合理的税收分配比例

### 9.2 运营最佳实践  
- 定期监控合约活动
- 及时响应社区反馈
- 保持透明的运营策略

通过本指南，您可以成功部署和运营SHIB风格的Meme代币合约。如有任何问题，请参考合约代码注释或联系技术支持。